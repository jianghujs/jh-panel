# wireguard-management-panel Specification

## ADDED Requirements
### Requirement: WireGuard 插件安装与服务控制
WireGuard 插件 SHALL 提供安装/卸载动作与服务状态检测能力，供面板服务入口与自动化调用。

#### Scenario: 执行安装
- **当** 系统未检测到 `wg` 命令且用户触发插件安装
- **则** 插件执行安装脚本并返回可见的安装结果信息。

#### Scenario: 服务状态获取
- **当** 系统检测到 `wg`/`wg-quick` 可用
- **则** 插件可返回 `wg0` 服务状态，供服务/自启动入口展示。

### Requirement: 密钥初始化面板
WireGuard 插件 SHALL 提供“密钥初始化”标签页，用于生成并展示公私钥。

#### Scenario: 未生成状态
- **当** 用户首次打开“密钥初始化”且未生成密钥
- **则** 公钥/私钥输入框为空，并显示“生成密钥”按钮。

#### Scenario: 生成与重新生成
- **当** 用户点击“生成密钥”或“重新生成”
- **则** 系统生成新的公私钥并写入预定路径，面板回显公钥与私钥内容；若已存在密钥则需二次确认后再覆盖。

### Requirement: 配置列表与编辑
WireGuard 插件 SHALL 提供“配置列表”标签页，展示 `/etc/wireguard/*.conf`，并支持新增、编辑、删除与备份。

#### Scenario: 配置列表加载
- **当** 用户进入“配置列表”
- **则** 系统列出配置文件名称、接口地址、监听端口、Peer 数量与最近握手时间（可选）。

#### Scenario: 新建配置
- **当** 用户点击“新增配置”
- **则** 面板提供默认配置内容供用户修改，并保存为指定接口的配置文件。

#### Scenario: 备份写入
- **当** 用户保存修改后的配置
- **则** 系统先生成时间戳备份再覆盖写入，并返回备份路径。

### Requirement: 点对点向导
WireGuard 插件 SHALL 在“配置列表”内提供点对点配置向导，以收集对端公网 IP/端口/公钥等信息并自动创建本地配置。

#### Scenario: 向导创建配置
- **当** 用户输入对端公网 IP/端口/公钥、IP 段与 AllowedIPs 等参数并保存
- **则** 系统写入本地配置文件，并在列表中可见。

### Requirement: 安全校验与错误反馈
WireGuard 插件 SHALL 对关键字段执行校验并避免输出敏感信息。

#### Scenario: 字段校验失败
- **当** 输入的 IP/端口/网段格式无效或与现有配置冲突
- **则** 面板阻止提交并给出具体错误原因。

#### Scenario: 私钥展示
- **当** 面板展示密钥信息
- **则** 公钥与私钥均以文本形式展示，但不写入日志。
