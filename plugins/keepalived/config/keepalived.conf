! Configuration File for keepalived
global_defs {
    script_user root
    enable_script_security
}

vrrp_script chk_wg {
    script "{$SERVER_PATH}/keepalived/scripts/chk_wireguard.py"
    interval 2
    weight -200
    fall 2
    rise 1
}


vrrp_script chk_network {
    script "/www/server/keepalived/scripts/chk_network.py"
    interval 2
    weight -200
    fall 2
    rise 1
}

vrrp_instance VI_1 {
  state MASTER
  interface wg0
  virtual_router_id 52
  priority 90
  nopreempt
  advert_int 2

  unicast_src_ip 10.0.0.1
  unicast_peer {
    10.0.0.2
  }

  virtual_ipaddress {
    10.0.0.100/32 dev wg0
  }

  authentication {
    auth_type PASS
    auth_pass "1111"
  }

  track_script {
    chk_wg
    chk_network
  }

  notify_backup "$SERVER_PATH}/keepalived/scripts/notify_backup.sh"
  notify_master "$SERVER_PATH/keepalived/scripts/notify_master.sh"
  notify "$SERVER_PATH/keepalived/scripts/notify.sh"

}